{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    {% include 'base/advisor-head.html' %}
    <title>Staff - Home</title>
</head>

<body x-data="{navIsOpen: false, open: false}">
    <div id="overlay"></div>

    <main class="xl:flex">
        {% include 'base/advisor-sidebar.html' %}

        <section class="grow">
            {% include 'base/advisor-header.html' %}

            <!-- Display this part if there are registered courses -->
            <div id="app" class="mt-12 p-2 overflow-y-scroll relative
            xl:mt-0">
                <div class="w-full h-full md:w-[40rem] flex flex-col items-center mx-auto ">
                    <div>
                        <h1 class="text-primary-700 text-2xl text-center">e-Library</h1>
                    </div>

                    <!-- Search Functionality -->
                    <div class="search-control p-2 w-full">
                        <form>
                            <div class="flex items-center justify-center">
                                <input type="search" placeholder="Search..." id="book-search" name="bookSearch"
                                    class="rounded-l border-2 border-[--primary-300] focus:border-transparent focus:bg-[var(--primary-50)] text-body-400 outline-none h-12 w-full pl-7 pr-2 placeholder:text-[var(--body-200)]">

                                <button type="submit"
                                    class="p-2 w-20 grid place-content-center rounded-r text-white bg-[--primary-500] h-12">
                                    <span class="material-symbols-rounded">search</span>
                                </button>
                            </div>

                            <div x-data="{filterIsOpen: false}"
                                class="flex items-center justify-between gap-4 relative">
                                <div class="select flex-grow md:max-w-[20rem]">
                                    <select name="criteria" id="searchBooksBy" class="w-full h-10">
                                        <option value="">Search by...</option>
                                        <option value="all">All books</option>
                                        <option value="title">Title</option>
                                        <option value="authot">Author</option>
                                        <!-- Add more -->
                                    </select>
                                </div>

                                <span x-on:click="filterIsOpen = true"
                                    class="border p-2 h-10 border-[--primary-500] material-symbols-rounded cursor-pointer text-[--primary-700]"
                                    title="Apply filters">tune</span>

                                <div x-show="filterIsOpen" x-on:click.outside="filterIsOpen = false"
                                    class="grid mt-1 absolute right-0 top-10 text-right bg-white border border-[--primary-500] rounded p-3 shadow z-10">

                                    <div class="select w-full">
                                        <label for="genre">Genre:</label>
                                        <select name="genre" class="w-full h-10">
                                            <option value="">Choose Genre</option>
                                            <option value="education">Education</option>
                                            <option value="action">Action</option>
                                            <option value="horror">Horror</option>
                                            <!-- Add more genres -->
                                        </select>
                                    </div>

                                    <div class="select w-full">
                                        <label for="tags">Tags:</label>
                                        <select name="tags" class="w-full h-10">
                                            <option value="">Choose tags</option>
                                            <option value="tag1">tag_name</option>
                                            <option value="tag2">tag_name</option>
                                            <option value="tag3">tag_name</option>
                                            <!-- Add more tags as needed -->
                                        </select>
                                    </div>

                                    <div>
                                        <label class="text-[--secondary-800] font-[600] text-[.85rem]">Publication
                                            Date:</label>
                                        <p class="text-xs mb-2">From:</p>
                                        <input class="input" name="startYear" id="startYear" type="number">
                                        <p class="text-xs mb-2">To:</p>
                                        <input class="input" name="endYear" id="endYear" type="number">
                                    </div>
                                </div>

                            </div>
                        </form>

                    </div>

                    <!-- Books display -->
                    <div x-data="{rec: true, pop: false, fav: false, uploaded: false, upload: false}"
                        class="w-full h-[80%] relative">
                        <div class="flex items-center md:justify-center py-2 sticky top-0 gap-5 overflow-x-scroll">
                            <button id="recommended-btn" type="button" method="get"
                                class="text-sm font-bold whitespace-nowrap flex-shrink-0">Recommended</button>

                            <button id="popular-btn" type="button"
                                class="text-sm font-bold whitespace-nowrap flex-shrink-0">Popular</button>

                            <button id="my-books-btn" type="button"
                                class="text-sm font-bold whitespace-nowrap flex-shrink-0">My Books</button>

                            <button id="uploaded-books-btn" type="button"
                                class="text-sm font-bold whitespace-nowrap flex-shrink-0">Uploaded Books</button>

                            <button id="upload-book-btn" type="button"
                                class="text-sm font-bold whitespace-nowrap flex-shrink-0">Upload a Book</button>
                        </div>

                        <div id="books-display" class="h-[85%] overflow-y-scroll grid  md:grid-cols-3 gap-2">
                            <!-- <div x-show="rec" class="h-[85%] overflow-y-scroll grid grid-cols-2 md:grid-cols-3 gap-2"> -->
                            <!--   Each div is wrapped in a link that directs to the details page of the book  -->
                            <div class="border min-h-40" style="min-width: 500px; position: relative;">
                                <div style="border: 1px solid #ddd; padding: 20px; display: flex;">
                                    <img src="https://alysbcohen.files.wordpress.com/2015/01/little-princess-book-cover.jpg"
                                        alt="Napoleon: A Biography"
                                        style="width: 100px; height: 150px; margin-right: 20px;">
                                    <div style="flex-grow: 1;">
                                        <div style="font-size: 18px; font-weight: bold;">Napoleon: A Biography</div>
                                        <div style="font-size: 14px; color: #555;">5.97 MB</div>
                                        <div style="font-size: 16px; margin-top: 5px;">Frank McLynn</div>
                                        <div style="font-size: 14px; color: #666; margin-top: 10px;">Lawrence James, The
                                            Times:
                                            Napoleon Bonaparte's
                                            ... so enthusiastic for Paul was Boswell that Dr...</div>
                                    </div>
                                    <div onclick="toggleMenu()"
                                        style="margin-left: auto; cursor: pointer; position: absolute; top: 10px; right: 10px;">
                                        ⋮</div>
                                </div>
                                <div id="smallmenu"
                                    style="display: none; position: absolute; right: 10px; top: 40px; background-color: #f9f9f9; min-width: 150px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1;">
                                    <a href="#"
                                        style="color: black; padding: 12px 16px; text-decoration: none; display: block;">Option
                                        1</a>
                                    <a href="#"
                                        style="color: black; padding: 12px 16px; text-decoration: none; display: block;">Option
                                        2</a>
                                    <a href="#"
                                        style="color: black; padding: 12px 16px; text-decoration: none; display: block;">Option
                                        3</a>
                                </div>
                                <div onclick="toggleStar(this)"
                                    style="cursor: pointer; position: absolute; bottom: 10px; right: 10px; font-size: 24px;">
                                    ☆</div>
                            </div>
                        </div>

                        <!-- Book upload -->
                        <div x-show="upload" class="h-[85%] overflow-y-scroll">
                            <div class="text-center font-bold">Upload Book</div>
                            <hr>
                            <form class="w-full grid gap-3 md:grid-cols-2" method="post" enctype="multipart/form-data">
                                {{ error_message }}
                                {% csrf_token %}
                                <div>
                                    <label for="id_title" class="text-sm text-[--secondary-800] font-bold">Title</label>
                                    {{ form.title }}
                                </div>

                                <div>
                                    <label for="id_subtitle"
                                        class="text-sm text-[--secondary-800] font-bold">Subtitle</label>
                                    {{ form.subtitle }}
                                </div>

                                <div>
                                    <label for="id_author"
                                        class="text-sm text-[--secondary-800] font-bold">Author</label>
                                    {{ form.author }}
                                </div>

                                <div>
                                    <label for="id_publication_year"
                                        class="text-sm text-[--secondary-800] font-bold">Year of
                                        Publication</label>
                                    {{ form.publication_year }}
                                </div>

                                <div>
                                    <label for="id_publisher"
                                        class="text-sm text-[--secondary-800] font-bold">Publisher</label>
                                    {{ form.publisher }}
                                </div>

                                <div class="select" style="margin: 0;">
                                    <label for="id_language"
                                        class="text-sm text-[--secondary-800] font-bold">Language</label>
                                    {{ form.language }}
                                </div>

                                <div>
                                    <label for="id_tags" class="text-sm text-[--secondary-800] font-bold">Tags</label>
                                    {{ form.tags }}
                                </div>

                                <div class="select" style="margin: 0;">
                                    <label for="id_genre">Genre</label>
                                    <select name="genre" id="id_genre" class="w-full h-10 -mt-[0.23rem]">
                                        <option value="">Select Genre</option>
                                        {% for genre in form.genre.field.queryset %}
                                        <option value="{{ genre.pk }}">{{ genre.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div>
                                    <label for="id_isbn" class="text-sm text-[--secondary-800] font-bold">ISBN</label>
                                    {{ form.isbn }}
                                </div>

                                <div class="file-input" style="margin: 0;">
                                    <label for="id_file" class="text-sm text-[--secondary-800] font-bold">Upload
                                        Document</label>
                                    {{ form.file }}
                                </div>

                                <div class="grid items-end">
                                    <button type="submit" style="background-color: green; color: white;"
                                        class="w-full h-10 font-semibold hover:bg-[--primary-600] transition-colors">Submit</button>
                                </div>


                            </form>

                        </div>
                    </div>
                </div>
            </div>

            <!--  -->

            <div x-show="open" x-on:click.outside="open = false" x-transition id="student-details"
                class="fixed top-12 right-0 bg-white flex flex-col gap-2 overflow-y-scroll w-80 p-2 shadow-lg z-[999]">

                <div class="rounded border border-slate-400 flex flex-col gap-4 items-center px-4 py-16">
                    <img src="../../assets/images/user.jpg" alt="user_img" class="w-32 h-32 object-cover rounded-full">

                    <div class="flex flex-col items-center gap-1 text-center">
                        <h1 class="text-body-800 text-2xl">
                            Staff Full Name
                        </h1>
                        <p class="text-slate-800">
                            Staff ID
                        </p>
                        <p class="text-slate-600 text-sm">
                            Class:
                            <span class="font-semibold text-slate-800">
                                20XX-20YY
                            </span>
                        </p>
                        <p class="text-slate-600 text-sm">HOD:
                            <span class="font-semibold text-slate-800">
                                HOD Name
                            </span>
                        </p>
                    </div>
                </div>

                <div class="bg-primary-50 rounded flex items-center justify-center p-1 gap-4">
                    <div class="flex flex-col items-center justify-end">
                        <p class="text-secondary-800 text-lg">20XX/20YY</p>
                        <p class="text-body-300">session</p>
                    </div>
                    <span class="bg-secondary-800 w-[1px] h-10"></span>
                    <div class="flex flex-col items-center justify-end">
                        <p class="text-secondary-800 text-lg">Harmattan</p>
                        <p class="text-body-300">semester</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
</body>
<script>
    function toggleMenu() {
        var menu = document.getElementById('smallmenu');
        /* menu.style.display = "show" */
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    function toggleStar(star, bookId) {
        // Make an AJAX request to star/unstar the book
        var xhr = new XMLHttpRequest();
        var csrftoken = getCookie('csrftoken'); // Function to get the CSRF token from cookies

        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    // Toggle the color of the star based on the response
                    star.style.color = xhr.responseText.trim() === 'Book has been successfully starred.' ? 'gold' : 'black';
                }
            }
        };
        xhr.open('POST', 'starbook/' + bookId + '/', true);
        xhr.setRequestHeader('X-CSRFToken', csrftoken); // Set CSRF token in request header
        xhr.send();
    }

    // Function to get CSRF token from cookies
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }


    /*     function toggleStar(star, bookId) {
            // Make an AJAX request to star/unstar the book
            console.log(bookId)
            var xhr = new XMLHttpRequest();
    
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        // Toggle the color of the star based on the response
                        star.style.color = xhr.responseText.trim() === 'Book has been successfully starred.' ? 'gold' : 'black';
                    }
                }
            };
            xhr.open('POST', 'starbook/' + bookId + '/', true);
            xhr.send();
        } */

    // Close the menu if the user clicks outside of it
    window.onclick = function (event) {
        if (!event.target.matches('.menu-button')) {
            var menu = document.getElementById('smallmenu');
            if (menu && menu.style.display === 'block') {
                menu.style.display = 'none';
            }
        }
    }
</script>


<script>
    document.getElementById('recommended-btn').addEventListener('click', function () {
        // Send GET request for recommended books
        fetch('/elibrary/api/?type=recommended')
            .then(response => response.json())
            .then(data => {
                // Render book cards based on the response data
                renderBookCards(data);
            })
            .catch(error => {
                // Handle error
                console.error('Error fetching recommended books:', error);
            });
    });

    document.getElementById('popular-btn').addEventListener('click', function () {
        // Send GET request for popular books
        fetch('/elibrary/api/?type=popular')
            .then(response => response.json())
            .then(data => {
                // Render book cards based on the response data
                renderBookCards(data);
            })
            .catch(error => {
                // Handle error
                console.error('Error fetching popular books:', error);
            });
    });

    document.getElementById('my-books-btn').addEventListener('click', function () {
        // Send GET request for user's books
        fetch('/elibrary/api/?type=my_books')
            .then(response => response.json())
            .then(data => {
                // Render book cards based on the response data
                renderBookCards(data);
            })
            .catch(error => {
                // Handle error
                console.error('Error fetching user\'s books:', error);
            });
    });

    document.getElementById('uploaded-books-btn').addEventListener('click', function () {
        // Send GET request for uploaded books
        fetch('/elibrary/api/?type=uploaded_books')
            .then(response => response.json())
            .then(data => {
                // Render book cards based on the response data
                renderBookCards(data);
            })
            .catch(error => {
                // Handle error
                console.error('Error fetching uploaded books:', error);
            });
    });

    document.getElementById('upload-book-btn').addEventListener('click', function () {
        // Redirect to upload page or display upload form
        const booksDisplay = document.getElementById('books-display');
        booksDisplay.innerHTML = '';
        const bookForm = `  <div  class="h-[85%] overflow-y-scroll">
                            <div class="text-center font-bold">Upload Book</div>
                            <hr>
                            <form class="w-full grid gap-3 md:grid-cols-2" method="post" enctype="multipart/form-data">
                                {{ error_message }}
                                {% csrf_token %}
                                <div>
                                    <label for="id_title" class="text-sm text-[--secondary-800] font-bold">Title</label>
                                    {{ form.title }}
                                </div>

                                <div>
                                    <label for="id_subtitle"
                                        class="text-sm text-[--secondary-800] font-bold">Subtitle</label>
                                    {{ form.subtitle }}
                                </div>

                                <div>
                                    <label for="id_author"
                                        class="text-sm text-[--secondary-800] font-bold">Author</label>
                                    {{ form.author }}
                                </div>

                                <div>
                                    <label for="id_publication_year"
                                        class="text-sm text-[--secondary-800] font-bold">Year of Publication</label>
                                    {{ form.publication_year }}
                                </div>

                                <div>
                                    <label for="id_publisher"
                                        class="text-sm text-[--secondary-800] font-bold">Publisher</label>
                                    {{ form.publisher }}
                                </div>

                                <div class="select" style="margin: 0;">
                                    <label for="id_language"
                                        class="text-sm text-[--secondary-800] font-bold">Language</label>
                                    {{ form.language }}
                                </div>

                                <div>
                                    <label for="id_tags" class="text-sm text-[--secondary-800] font-bold">Tags</label>
                                    {{ form.tags }}
                                </div>

                                <div class="select" style="margin: 0;">
                                    <label for="id_genre">Genre</label>
                                    <select name="genre" id="id_genre" class="w-full h-10 -mt-[0.23rem]">
                                        <option value="">Select Genre</option>
                                        {% for genre in form.genre.field.queryset %}
                                        <option value="{{ genre.pk }}">{{ genre.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div>
                                    <label for="id_isbn" class="text-sm text-[--secondary-800] font-bold">ISBN</label>
                                    {{ form.isbn }}
                                </div>

                                <div class="file-input" style="margin: 0;">
                                    <label for="id_file" class="text-sm text-[--secondary-800] font-bold">Upload
                                        Document</label>
                                    {{ form.file }}
                                </div>

                                <div class="grid items-end">
                                    <button type="submit" style="background-color: green; color: white;"
                                        class="w-full h-10 font-semibold hover:bg-[--primary-600] transition-colors">Submit</button>
                                </div>


                            </form>
                        </div>
        
        `;
        booksDisplay.innerHTML += bookForm;
        console.log('Upload a Book button clicked');
    });

    function renderBookCards(books) {
        const booksDisplay = document.getElementById('books-display');
        booksDisplay.innerHTML = '';

        books.forEach(book => {
            const starColor = book.is_favorite ? 'gold' : 'black';
            const bookCard = `
            <div class="border min-h-40" style = "min-width: 500px; position: relative;" >
                    <div style="border: 1px solid #ddd; padding: 20px; display: flex;">
                        <img src="https://alysbcohen.files.wordpress.com/2015/01/little-princess-book-cover.jpg" alt="${book.title}"
                            style="width: 100px; height: 150px; margin-right: 20px;">
                        <div style="flex-grow: 1;">
                            <div style="font-size: 18px; font-weight: bold;">${book.title}</div>
                            <div style="font-size: 14px; color: #555;">5.97 MB</div>
                            <div style="font-size: 16px; margin-top: 5px;">${book.author}</div>
                            <div style="font-size: 14px; color: #666; margin-top: 10px;">${book.subtitle}</div>
                        </div>
                        <div onclick="toggleMenu()"
                            style="margin-left: auto; cursor: pointer; position: absolute; top: 10px; right: 10px;">
                            ⋮
                        </div>
                    </div>
                    <div id="smallmenu"
                        style="display: none; position: absolute; right: 10px; top: 40px; background-color: #f9f9f9; min-width: 150px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1;">
                        <a href="#" style="color: black; padding: 12px 16px; text-decoration: none; display: block;">Option
                            1</a>
                        <a href="#" style="color: black; padding: 12px 16px; text-decoration: none; display: block;">Option
                            2</a>
                        <a href="#" style="color: black; padding: 12px 16px; text-decoration: none; display: block;">Option
                            3</a>
                    </div>
                    <div onclick="toggleStar(this, ${book.id})"
                        style="color: ${starColor}; cursor: pointer; position: absolute; bottom: 10px; right: 10px; font-size: 24px;">
                        ☆
                    </div>
                </div >
            `;
            booksDisplay.innerHTML += bookCard;
        });
    }
</script>




<!-- <script>
    document.getElementById('recommended-btn').addEventListener('click', function () {
        // Send GET request for recommended books
        fetch('/elibrary/api/?type=recommended')
            .then(response => response.json())
            .then(data => {
                // Render book cards based on the response data
                console.log(data);
            })
            .catch(error => {
                // Handle error
                console.error('Error fetching recommended books:', error);
            });
    });

    document.getElementById('popular-btn').addEventListener('click', function () {
        // Send GET request for popular books
        fetch('/elibrary/api/?type=popular')
            .then(response => response.json())
            .then(data => {
                // Render book cards based on the response data
                console.log(data);
            })
            .catch(error => {
                // Handle error
                console.error('Error fetching popular books:', error);
            });
    });

    document.getElementById('my-books-btn').addEventListener('click', function () {
        // Send GET request for user's books
        fetch('/elibrary/api/?type=my_books')
            .then(response => response.json())
            .then(data => {
                // Render book cards based on the response data
                console.log(data);
            })
            .catch(error => {
                // Handle error
                console.error('Error fetching user\'s books:', error);
            });
    });

    document.getElementById('uploaded-books-btn').addEventListener('click', function () {
        // Send GET request for uploaded books
        fetch('/elibrary/api/?type=uploaded_books')
            .then(response => response.json())
            .then(data => {
                // Render book cards based on the response data
                console.log(data);
            })
            .catch(error => {
                // Handle error
                console.error('Error fetching uploaded books:', error);
            });
    });

    document.getElementById('upload-book-btn').addEventListener('click', function () {
        // Redirect to upload page or display upload form
        console.log('Upload a Book button clicked');
    });
</script> -->



{% include 'base/advisor-footer.html' %}

</html>